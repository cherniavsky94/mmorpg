<!DOCTYPE html>
<html>
<head>
  <title>Server Test</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    .log { margin: 5px 0; padding: 5px; border-left: 3px solid #ccc; }
    .success { border-color: green; background: #e8f5e9; }
    .error { border-color: red; background: #ffebee; }
    button { padding: 10px 20px; margin: 10px 5px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Server Connectivity Test</h1>
  
  <div>
    <button onclick="testHealth()">Test Health Endpoint</button>
    <button onclick="testMatchmaking()">Test Matchmaking</button>
    <button onclick="testAll()">Test All</button>
  </div>

  <div id="logs"></div>

  <script>
    const log = (msg, isError = false) => {
      const div = document.createElement('div');
      div.className = 'log ' + (isError ? 'error' : 'success');
      div.textContent = new Date().toISOString() + ': ' + msg;
      document.getElementById('logs').insertBefore(div, document.getElementById('logs').firstChild);
      console.log(msg);
    };

    const urls = {
      gitpod: 'https://2567--019b03d2-4e60-7251-a151-670a306cc63e.eu-central-1-01.gitpod.dev',
      localhost: 'http://localhost:2567'
    };

    async function testHealth() {
      log('=== Testing Health Endpoints ===');
      
      for (const [name, baseUrl] of Object.entries(urls)) {
        try {
          log(`Testing ${name}: ${baseUrl}/`);
          const response = await fetch(`${baseUrl}/`, {
            method: 'GET',
            headers: { 'Accept': 'application/json' }
          });
          
          if (response.ok) {
            const data = await response.json();
            log(`✅ ${name} health check OK: ${JSON.stringify(data)}`);
          } else {
            log(`❌ ${name} returned ${response.status}: ${response.statusText}`, true);
          }
        } catch (error) {
          log(`❌ ${name} error: ${error.message}`, true);
        }
      }
    }

    async function testMatchmaking() {
      log('=== Testing Matchmaking Endpoints ===');
      
      for (const [name, baseUrl] of Object.entries(urls)) {
        try {
          log(`Testing ${name}: ${baseUrl}/matchmake/joinOrCreate/city`);
          const response = await fetch(`${baseUrl}/matchmake/joinOrCreate/city`, {
            method: 'POST',
            headers: { 
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: '{}'
          });
          
          if (response.ok) {
            const data = await response.json();
            log(`✅ ${name} matchmaking OK: Room ${data.room.roomId}, Session ${data.sessionId}`);
          } else {
            const text = await response.text();
            log(`❌ ${name} returned ${response.status}: ${text}`, true);
          }
        } catch (error) {
          log(`❌ ${name} error: ${error.message}`, true);
        }
      }
    }

    async function testAll() {
      document.getElementById('logs').innerHTML = '';
      await testHealth();
      await new Promise(r => setTimeout(r, 1000));
      await testMatchmaking();
    }

    // Auto-run on load
    window.onload = () => {
      log('Page loaded. Click buttons to test server connectivity.');
    };
  </script>
</body>
</html>
